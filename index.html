<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <style>
        /* ... (ä¿ç•™åŸæœ¬çš„æ¨£å¼) ... */
        
        /* ğŸŸ¢ æ–°å¢ï¼šå³æœŸå“æ¨™ç±¤æ¨£å¼ (å³ä¸Šè§’) */
        .short-date-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: #ff9800; /* äº®æ©˜è‰² */
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
            padding: 4px 10px;
            border-bottom-left-radius: 15px;
            border-top-right-radius: 15px; /* é…åˆå¡ç‰‡åœ“è§’ */
            z-index: 20;
            box-shadow: -2px 2px 5px rgba(0,0,0,0.1);
        }
        
        /* åˆ°æœŸæ—¥æ–‡å­— (é¡¯ç¤ºåœ¨æ¨™ç±¤ä¸‹æ–¹æˆ–å¡ç‰‡å…§å®¹è£¡) */
        .expiry-info {
            color: #e65100;
            font-size: 0.8rem;
            font-weight: bold;
            display: block;
            margin-top: 2px;
        }
    </style>
</head>
<body>
<script>
    // ... (LIFF, GAS_URL ç­‰è®Šæ•¸ä¿æŒä¸è®Š) ...

    // ğŸŸ¢ ä¿®æ”¹ï¼šå»ºç«‹å•†å“å¡ç‰‡å‡½å¼
    function createProductCard(p) {
        const inCart = cart.find(c => c.name === p.name && c.cat === p.cat); 
        const count = inCart ? inCart.count : 0; 
        const isOOS = p.status === 'oos' || p.stock <= 0;
        
        const imgHtml = p.img ? `<img src="${p.img}" class="product-img" onclick="zoomImg(event, '${p.img}')" referrerpolicy="no-referrer">` : `<div class="product-img d-flex align-items-center justify-content-center text-muted"><i class="bi bi-camera fs-1"></i></div>`;
        
        let stockHtml = `<span class="stock-info">å‰©: ${p.stock}</span>`;
        if (p.stock <= 0 && p.arrivalDate) { 
            let d = new Date(p.arrivalDate);
            let dateStr = !isNaN(d.getTime()) ? (d.getMonth()+1)+'/'+d.getDate() : p.arrivalDate;
            stockHtml += `<div class="arrival-info small">${dateStr} åˆ°è²¨</div>`; 
        }

        // ğŸŸ¢ åˆ¤æ–·æ˜¯å¦ç‚ºå³æœŸå“
        let badgeHtml = "";
        let expiryHtml = "";
        if (p.isShortDated) {
            badgeHtml = `<div class="short-date-badge">å³æœŸå“</div>`;
            if (p.expiryDate) {
                let d = new Date(p.expiryDate);
                // æ ¼å¼åŒ–æ—¥æœŸç‚º YYYY/M/D æˆ– M/D
                let dateStr = !isNaN(d.getTime()) ? `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}` : p.expiryDate;
                // åŠ åœ¨åƒ¹æ ¼æ—é‚Šæˆ–ä¸‹æ–¹
                expiryHtml = `<div class="expiry-info"><i class="bi bi-hourglass-split"></i> ${dateStr} åˆ°æœŸ</div>`;
            }
        }
        
        let btnHtml = isOOS ? `<span class="badge bg-secondary position-absolute bottom-0 end-0 m-2">è£œè²¨ä¸­</span>` : (count > 0 ? `<div class="qty-group"><button class="qty-btn" onclick="updateQty('${p.name}', '${p.cat}', -1)">-</button><span class="qty-val">${count}</span><button class="qty-btn" onclick="updateQty('${p.name}', '${p.cat}', 1)">+</button></div>` : `<div class="btn-add-only" onclick="updateQty('${p.name}', '${p.cat}', 1)"><i class="bi bi-plus-lg"></i></div>`);
        const cardClass = isOOS ? 'oos-mode' : ''; 
        
        return `
        <div class="col-6 col-md-4">
            <div class="product-card ${cardClass}">
                <div class="position-relative">
                    ${badgeHtml} ${imgHtml}
                </div>
                <div class="product-body">
                    <div class="product-name text-truncate">${p.name}</div>
                    <div class="product-price">$${p.price}</div>
                    ${expiryHtml} ${stockHtml}
                    ${btnHtml}
                </div>
            </div>
        </div>`;
    }

    // ... (å…¶é¤˜ updateQty, submitOrder ç­‰å‡½å¼ä¿æŒä¸è®Š) ...
</script>
</body>
</html>
